<h2>Add a new café</h2>

{{#if error}}
<div class="alert-red">
  {{error}}
</div>
{{/if}}

<form action="/auth/add-cafe" method="POST" enctype="multipart/form-data">
  <label>Name:</label>
    <input type="text" name="name"> <br>
  <br><br>

  <label>Wifi:</label>
    <div>
      <input type="radio" name="wifi" value="yes"
         checked>
      <label for="yes">Yes</label>
    </div>
    <div>
      <input type="radio" name="wifi" value="no">
      <label for="no">No</label>
    </div>
    <br><br>

  <label>Power outlet:</label>
    <div>
      <input type="radio" name="powerSocket" value="yes"
         checked>
      <label for="yes">Yes</label>
    </div>
    <div>
      <input type="radio" name="powerSocket" value="no">
      <label for="no">No</label>
    </div>
  <br><br>

  <label>Location:</label>
  <div class="input-group mb-3">
  <div id='geocoderAddCafe' class='geocoder'>  </div>
</div>
<div id='mapAddCafe' style='width: 400px; height: 300px;'></div>
<div class="hidden">
    <input type="text" name="latitude" id="lat" placeholder="latitude" >
    <input type="text" name="longitude" id="lng" placeholder="longitude">
    <input type="text" name="address" id="address" placeholder="address">
    </div>
  <br><br>

  <label>Upload a picture</label>
  <input type="file" name="photo">
  <br><br>

 <button type="submit">Add a new café</button>
</form>



<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src='https://api.mapbox.com/mapbox-gl-js/v0.51.0/mapbox-gl.js'></script>
<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.3.0/mapbox-gl-geocoder.min.js'></script>
<script src="/javascripts/script.js"></script>


<script>

  mapboxgl.accessToken = "{{mapboxAPIKey}}";
  var map = new mapboxgl.Map({
    container: 'mapAddCafe',
    center: [13.1445545, 52.5065133], // starting position [longitude,latitude]
    zoom: 9, // starting zoom
    style: 'mapbox://styles/mapbox/streets-v9',
  });

  
  map.addControl(new mapboxgl.NavigationControl())
  
  var geocoder = new MapboxGeocoder({
    accessToken: mapboxgl.accessToken,
    placeholder: "Add address of café",
  });


map.on("moveend", ()=> {
let lat = Number(map.boxZoom._map.transform._center.lat)
let lng = map.boxZoom._map.transform._center.lng
document.getElementById("lat").value = lat
document.getElementById("lng").value = lng
console.log(`https://api.mapbox.com/geocoding/v5/mapbox.places/${lng},${lat}.json?access_token=pk.eyJ1IjoibWF0dGhpYXNmcml0eiIsImEiOiJjam9mbGo1OXgwNTh6M2txemw4aWNjMTgwIn0.cgF_suP2Mh9JtoKF20kjyQ`)
axios.get(`https://api.mapbox.com/geocoding/v5/mapbox.places/${lng},${lat}.json?access_token=pk.eyJ1IjoibWF0dGhpYXNmcml0eiIsImEiOiJjam9mbGo1OXgwNTh6M2txemw4aWNjMTgwIn0.cgF_suP2Mh9JtoKF20kjyQ`)
.then (res => {
  document.getElementById("address").value = res.data.features[0].place_name
})

})






document.getElementById('geocoderAddCafe').appendChild(geocoder.onAdd(map));


</script>
